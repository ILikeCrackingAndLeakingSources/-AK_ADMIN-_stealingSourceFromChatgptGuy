if _G.AKAdminLoaded then
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "AK ADMIN",
        Text = "Script is already running!",
        Duration = 5
    })
    return
end

_G.AKAdminLoaded = true

-- Command handler system
local CommandSystem = {
    prefix = "!",  -- Default prefix for commands
    commands = {},
}

-- Register a new command
function CommandSystem:RegisterCommand(name, callback, description)
    self.commands[name:lower()] = {
        callback = callback,
        description = description
    }
end

-- Handle command execution
function CommandSystem:HandleCommand(message)
    if not message:sub(1, 1) == self.prefix then return end
    
    local args = message:sub(2):split(" ")
    local commandName = args[1]:lower()
    table.remove(args, 1)
    
    local command = self.commands[commandName]
    if command then
        command.callback(args)
    end
end

local function RemoveAtmosphereAndSetFog()
    local Lighting = game:GetService("Lighting")
    Lighting.FogEnd = 100000
    
    for _, v in pairs(Lighting:GetDescendants()) do
        if v:IsA("Atmosphere") then
            v:Destroy()
        end
    end
end

-- Call the function
RemoveAtmosphereAndSetFog()

-- Load external scripts with better error handling
local function loadExternalScript(url)
    local success, result = pcall(function()
        return loadstring(game:HttpGet(url))()
    end)
    
    if not success then
        warn("Failed to load script from " .. url .. ": " .. tostring(result))
    end
end

-- URLs for external scripts
local scriptUrls = {
    "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/Verfiedbadge.luau",
    "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/firebutton",
    "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/goto.luau",
    "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/copyavatar",
    "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/stands.luau"
}

-- Load all external scripts
for _, url in ipairs(scriptUrls) do
    loadExternalScript(url)
end

local player = game.Players.LocalPlayer
local oldChat = game.ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")

local function Chat(msg)
    if oldChat then
        game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
    else
        game.TextChatService.TextChannels.RBXGeneral:SendAsync(msg)
    end
end

-- Load additional scripts
loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadownercmds.luau"))()
loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadhook.luau"))()

-- Notification system
local function showNotification(message, backgroundColor)
    local gui = Instance.new("ScreenGui")
    gui.Name = "Notification"
    gui.Parent = player.PlayerGui
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = backgroundColor
    frame.Parent = gui
    
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Size = UDim2.new(1, 0, 1, 0)
    messageLabel.Position = UDim2.new(0, 0, 0, 0)
    messageLabel.Text = message
    messageLabel.TextSize = 36
    messageLabel.Parent = frame
    
    repeat
        wait(1)
        isWhitelisted = false
        for _, whitelistedUser in ipairs(whitelistedPlayers) do
            if (playerName:lower() == whitelistedUser:lower()) then
                isWhitelisted = true
                break
            end
        end
    until isWhitelisted 
    gui:Destroy()
end

-- Whitelist check
local playerName = player.Name
local isWhitelisted = false

for _, whitelistedUser in ipairs(getgenv().whitelistedPlayers) do
    if (playerName:lower() == whitelistedUser:lower()) then
        isWhitelisted = true
        break
    end
end

if not isWhitelisted then
    local function kickPlayer()
        setclipboard("https://discord.gg/akadmin")
        game.Players.LocalPlayer:Kick("You are not whitelisted. discord copied to clipboard, get points or buy lifetime.")
    end
    kickPlayer()
    print("You are not whitelisted. Execute non-whitelisted logic here.")
else
    -- Load whitelisted player scripts
    local whitelistedScripts = {
        "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/allcmds.luau",
        "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/AK%20intro",
        "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/Ak%20Update%20logs%20gui",
        "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadcmds.luau",
        "https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadplayertags.luau"
    }
    
    for _, url in ipairs(whitelistedScripts) do
        loadExternalScript(url)
    end
    
    -- Queue on teleport handling
    local queueonteleport = (syn and syn.queue_on_teleport) or queue_on_teleport or (fluxus and fluxus.queue_on_teleport)
    
    if queueonteleport then
        queueonteleport("loadstring(game:HttpGet('https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/Ak%20Admin'))()")
    end
end

-- Connect chat command handler
game.Players.LocalPlayer.Chatted:Connect(function(message)
    CommandSystem:HandleCommand(message)
end)

-- Example of registering a command
CommandSystem:RegisterCommand("help", function(args)
    local commandList = "Available Commands:\n"
    for cmdName, cmdData in pairs(CommandSystem.commands) do
        commandList = commandList .. CommandSystem.prefix .. cmdName .. " - " .. cmdData.description .. "\n"
    end
end, "Shows list of available commands")
-- Create the ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AdminActiveGUI"
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui") -- Attach to the player's GUI

-- Create the green dot (with fade and pulse animation)
local dot = Instance.new("Frame")
dot.Name = "HeartbeatDot"
dot.Parent = screenGui
dot.Size = UDim2.new(0, 10, 0, 10) -- 20x20 pixels
dot.Position = UDim2.new(1, -135, 0, -40) -- Position near the "A" in the top-right corner, 10 pixels from the top edge
dot.BackgroundColor3 = Color3.new(0, 1, 0) -- Green color
dot.BorderSizePixel = 0
dot.AnchorPoint = Vector2.new(0.5, 0.5) -- Centered scaling

-- Add rounded corners to the green dot
local uiCorner = Instance.new("UICorner", dot)
uiCorner.CornerRadius = UDim.new(1, 0) -- Fully round shape

-- Create the text label (positioned next to the "A")
local label = Instance.new("TextLabel")
label.Name = "AdminStatusLabel"
label.Parent = screenGui
label.Size = UDim2.new(0, 100, 0, 30) -- Smaller size for the text
label.Position = UDim2.new(1, -125, 0, -55) -- Position in the top-right corner with some offset from the right
label.Text = "AK Admin Active"
label.TextColor3 = Color3.new(1, 1, 1) -- White text
label.TextScaled = true
label.BackgroundTransparency = 1 -- No background
label.Font = Enum.Font.SourceSansBold

-- Add heartbeat animation to the green dot with fading effect
local TweenService = game:GetService("TweenService")
local heartbeatInfo = TweenInfo.new(
    0.5, -- Animation time (half a second)
    Enum.EasingStyle.Sine, -- Sine easing for smooth effect
    Enum.EasingDirection.InOut, -- Eases in and out
    -1, -- Infinite repeat count
    true -- Reverse animation on repeat
)

local heartbeatTween = TweenService:Create(dot, heartbeatInfo, {
    Size = UDim2.new(0, 15, 0, 15), -- Pulsing size
    BackgroundTransparency = 0.5, -- Fade out when big
})
local shrinkTween = TweenService:Create(dot, heartbeatInfo, {
    Size = UDim2.new(0, 10, 0, 10), -- Shrinking size
    BackgroundTransparency = 0, -- Fully visible when small
})

-- Play the heartbeat animation with fade effect
heartbeatTween:Play()

-- Animation control: Fade the dot while it grows
dot:GetPropertyChangedSignal("Size"):Connect(function()
    if dot.Size.X.Scale == 0.15 then -- When it's large
        heartbeatTween:Cancel()
        shrinkTween:Play()
    elseif dot.Size.X.Scale == 0.1 then -- When it's small
        shrinkTween:Cancel()
        heartbeatTween:Play()
    end
end)
