if _G.AKAdminLoaded then
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "AK ADMIN",
        Text = "Script is already running!",
        Duration = 5
    })
    return
end

_G.AKAdminLoaded = true

local function RemoveAtmosphereAndSetFog()
    local Lighting = game:GetService("Lighting")
    Lighting.FogEnd = 100000
    
    for _, v in pairs(Lighting:GetDescendants()) do
        if v:IsA("Atmosphere") then
            v:Destroy()
        end
    end
end

-- Call the function
RemoveAtmosphereAndSetFog()

local success, result = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/Verfiedbadge.luau"))()
end)
pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/firebutton"))()
end)
pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/goto.luau"))()
end)
pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/copyavatar"))()
end)
pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/stands.luau"))()
end)

if not success then
    warn("Failed to load script: " .. tostring(result))
else
    print("Script loaded successfully!")
end

local player = game.Players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")
local chatService = game:GetService("TextChatService")
local defaultChannel = chatService.TextChannels.RBXGeneral or replicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")

local function Chat(msg)
    if defaultChannel then
        defaultChannel.SayMessageRequest:FireServer(msg, "All")
    else
        game.TextChatService.TextChannels.RBXGeneral:SendAsync(msg)
    end
end

-- Automatically listen for specific commands in chat
player.Chatted:Connect(function(message)
    local command = message:lower()
    if command == "!removefog" then
        RemoveAtmosphereAndSetFog()
    elseif command == "!loadcmds" then
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadcmds.luau"))()
    end
end)

-- Load additional components
loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadownercmds.luau"))()
loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadhook.luau"))()

local playerName = player.Name
local isWhitelisted = false

for _, whitelistedUser in ipairs(getgenv().whitelistedPlayers) do
    if playerName:lower() == whitelistedUser:lower() then
        isWhitelisted = true
        break
    end
end

if not isWhitelisted then
    local function kickPlayer()
        game.Players.LocalPlayer:Kick("You are not whitelisted. Discord copied to clipboard. Get points or buy lifetime.")
    end
    setclipboard("https://discord.gg/akadmin")
    kickPlayer()
    print("You are not whitelisted. Execute non-whitelisted logic here.")
else
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/allcmds.luau"))()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/AK%20intro"))()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/Ak%20Update%20logs%20gui"))()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadcmds.luau"))()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/loadplayertags.luau"))()
    
    local queueonteleport = (syn and syn.queue_on_teleport) or queue_on_teleport or (fluxus and fluxus.queue_on_teleport)
    if queueonteleport then
        queueonteleport("loadstring(game:HttpGet('https://raw.githubusercontent.com/Alikhammass/MyAdmin/refs/heads/main/Ak%20Admin'))()")
    end
end
