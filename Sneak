local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

-- Create a large second baseplate (invisible)
local secondBaseplatePosition = Vector3.new(108.033035, -6, -24.9428463)
local secondBaseplate = Instance.new("Part")
secondBaseplate.Size = Vector3.new(1024, 1, 1024)
secondBaseplate.Position = secondBaseplatePosition
secondBaseplate.Anchored = true
secondBaseplate.Name = "SecondBaseplate"
secondBaseplate.BrickColor = BrickColor.new("Medium green")
secondBaseplate.Material = Enum.Material.Grass
secondBaseplate.CanCollide = true
secondBaseplate.Transparency = 1
secondBaseplate.Parent = game.Workspace

-- Smooth surface for the baseplate
secondBaseplate.TopSurface = Enum.SurfaceType.Smooth
secondBaseplate.BottomSurface = Enum.SurfaceType.Smooth

-- Create the invisible barrier above the player
local invisibleBarrier = Instance.new("Part")
invisibleBarrier.Size = Vector3.new(1024, 5, 1024) -- thick enough to block the player
invisibleBarrier.Anchored = true
invisibleBarrier.CanCollide = true -- blocks player movement when floating down
invisibleBarrier.Transparency = 1
invisibleBarrier.Name = "InvisibleBarrier"
invisibleBarrier.Parent = game.Workspace

-- Create GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BaseplateControlGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Create a frame for GUI elements
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 120, 0, 120)
frame.Position = UDim2.new(0.5, -60, 0, 20)  -- Position at the top middle
frame.BackgroundTransparency = 0.5
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Parent = screenGui

-- Add a UI corner for rounded edges
local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 10)
frameCorner.Parent = frame

-- Create the toggle button (initially "Sneak Up")
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 100, 0, 30)
toggleButton.Position = UDim2.new(0.5, -50, 0.1, 0)
toggleButton.Text = "Sneak Up"
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleButton.BackgroundTransparency = 0.2
toggleButton.TextSize = 14
toggleButton.Font = Enum.Font.SourceSans
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Parent = frame

-- Add a UI corner for rounded edges
local toggleButtonCorner = Instance.new("UICorner")
toggleButtonCorner.CornerRadius = UDim.new(0, 8)
toggleButtonCorner.Parent = toggleButton

-- Create the up button
local upButton = Instance.new("TextButton")
upButton.Size = UDim2.new(0, 40, 0, 30)
upButton.Position = UDim2.new(0.3, -20, 0.6, 0)
upButton.Text = "▲"
upButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
upButton.BackgroundTransparency = 0.2
upButton.TextSize = 20
upButton.Font = Enum.Font.SourceSans
upButton.TextColor3 = Color3.fromRGB(255, 255, 255)
upButton.Parent = frame

-- Add a UI corner for rounded edges
local upButtonCorner = Instance.new("UICorner")
upButtonCorner.CornerRadius = UDim.new(0, 8)
upButtonCorner.Parent = upButton

-- Create the down button
local downButton = Instance.new("TextButton")
downButton.Size = UDim2.new(0, 40, 0, 30)
downButton.Position = UDim2.new(0.7, -20, 0.6, 0)
downButton.Text = "▼"
downButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
downButton.BackgroundTransparency = 0.2
downButton.TextSize = 20
downButton.Font = Enum.Font.SourceSans
downButton.TextColor3 = Color3.fromRGB(255, 255, 255)
downButton.Parent = frame

-- Add a UI corner for rounded edges
local downButtonCorner = Instance.new("UICorner")
downButtonCorner.CornerRadius = UDim.new(0, 8)
downButtonCorner.Parent = downButton

-- Function to move the baseplate up
local function moveBaseplateUp()
    if not isFloatingUp then  -- Only move baseplate when floating down
        secondBaseplate.Position = secondBaseplate.Position + Vector3.new(0, 1, 0) -- Adjust step as needed
    end
end

-- Function to move the baseplate down
local function moveBaseplateDown()
    if not isFloatingUp then  -- Only move baseplate when floating down
        secondBaseplate.Position = secondBaseplate.Position - Vector3.new(0, 1, 0) -- Adjust step as needed
    end
end

-- Connect buttons to functions
upButton.MouseButton1Click:Connect(moveBaseplateUp)
downButton.MouseButton1Click:Connect(moveBaseplateDown)

-- Float functionality
local function clearForces()
    for _, child in pairs(humanoidRootPart:GetChildren()) do
        if child:IsA("BodyVelocity") or child:IsA("BodyGyro") or child:IsA("BodyPosition") then
            child:Destroy()
        end
    end
end

local function noclipUpdate()
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
end

local function floatDown()
    clearForces()
    noclipUpdate()
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, -2, 0)
    bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
    bodyVelocity.Parent = humanoidRootPart
    game:GetService("Debris"):AddItem(bodyVelocity, 2)
end

local function floatUp()
    clearForces()
    noclipUpdate()
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 2, 0)
    bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
    bodyVelocity.Parent = humanoidRootPart
    game:GetService("Debris"):AddItem(bodyVelocity, 2)
end

local isFloatingUp = false  -- Start with "Sneak Up" (floating down initially)

-- Toggle button functionality
toggleButton.MouseButton1Click:Connect(function()
    isFloatingUp = not isFloatingUp
    if isFloatingUp then
        toggleButton.Text = "Sneak Down"  -- Change text to "Sneak Down" when floating up
        floatUp()
        local existingBarrier = game.Workspace:FindFirstChild("InvisibleBarrier")
        if existingBarrier then
            existingBarrier:Destroy()  -- Remove invisible barrier when floating up
        end
    else
        toggleButton.Text = "Sneak Up"  -- Change text back to "Sneak Up" when floating down
        floatDown()
        if not game.Workspace:FindFirstChild("InvisibleBarrier") then
            invisibleBarrier = Instance.new("Part")
            invisibleBarrier.Size = Vector3.new(1024, 5, 1024)
            invisibleBarrier.Anchored = true
            invisibleBarrier.CanCollide = true  -- Ensure it blocks player movement when floating down
            invisibleBarrier.Transparency = 1
            invisibleBarrier.Name = "InvisibleBarrier"
            invisibleBarrier.Parent = game.Workspace
        end
    end
end)

-- Update the position of the invisible barrier above the player
game:GetService("RunService").Stepped:Connect(function()
    noclipUpdate()
    local existingBarrier = game.Workspace:FindFirstChild("InvisibleBarrier")
    if existingBarrier then
        existingBarrier.Position = humanoidRootPart.Position + Vector3.new(0, 5, 0)
    end
end)

-- Handle respawn and reapply changes
local function onCharacterAdded(newCharacter)
    character = newCharacter
    humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    humanoid = character:WaitForChild("Humanoid")
    clearForces()
    noclipUpdate()
end

-- Connect respawn event
player.CharacterAdded:Connect(onCharacterAdded)

-- Start by floating the player down
floatDown()
